<!--Search Bar-->
<div class="ui main menu">
  <div class="flex item">
    <div class="ui icon input">
      <input type="text" placeholder="Search..." [formControl]="query">
      <i class="search icon"></i>
    </div>
  </div>
  <div class="right menu">
    <div class="item">
      <div #drop_data class="ui basic multiple search selection dropdown">
        <input type="hidden">
        <i class="dropdown icon"></i>
        <div class="default text">Select Data</div>
        <div class="menu">
          <div class="item" data-value="dcm">
            Dicom
          </div>
          <div class="item" data-value="anno">
            Annotations
          </div>
        </div>
      </div>
    </div>

    <div class="item">
      <div class="ui tiny teal buttons">
        <div class="ui button" [class.disabled]="selectedNumber == 0 || dataTypes.length == 0" (click)="transfer()">
          Download
        </div>
        <div #drop_action class="ui floating dropdown icon button" [class.disabled]="selectedNumber == 0">
          <i class="dropdown icon"></i>
          <div class="menu">
            <div class="item" (click)="openDsModel()">Create Dataset</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Result Segment-->
<div class="ui content segment" style="overflow-y: scroll; height: calc(100vh - 175px);">
  <table class="ui very basic table">
    <thead>
      <tr>
        <th>
          <div class="ui checkbox">
            <input type="checkbox" [checked]="allSelected" (click)="selectAll()">
            <label></label>
          </div>
        </th>
        <th>Image</th>
        <th>DateTime</th>
        <th>Modality</th>
        <th>Laterality</th>
        <th>Columns x Rows</th>
        <th>Transferred</th>
      </tr>
    </thead>
    <tbody>
      <template ngFor let-image [ngForOf]="images.slice(selectedPage*pageSize, selectedPage*pageSize + pageSize)">
        <!--Image Info-->
        <tr>
          <!--Selection-->
          <td class="collapsing">
            <div class="ui checkbox">
              <input type="checkbox" [checked]="image.selected" (click)="selectImage(image)">
              <label></label>
            </div>
          </td>
          
          <!--Image-->
          <td>
            <i class="large {{image.open ? 'down' : 'right'}} triangle link icon" (click)="image.open = !image.open"></i>
            <i attr.id="image_link_{{image.uid}}" class="large blue unhide icon" (mouseenter)="openImagePopup(image.uid)"></i>
            <div class="ui very wide popup">
              <img class="ui fluid image" [src]="image.url">
            </div>
            {{image.uid}}
          </td>

          <!--DateTime-->
          <td>{{image.datetime}}</td>

          <!--Modality-->
          <td>{{image.modality}}</td>

          <!--Laterality-->
          <td>{{image.laterality}}</td>
          
          <!--Columns x Rows-->
          <td>{{image.columns}}x{{image.rows}}</td>
          
          <!--Transferred-->
          <td>
            <i class="large {{ image.transferred ? 'green' : '' }} upload icon"></i>
          </td>
        </tr>

        <!--Image Details-->
        <tr *ngIf="image.open">
          <td colspan="7">
            <div class="ui relaxed list" style="padding-left: 3em">
              <!--Patient-->
              <div class="item">
                <i class="large blue user icon"></i>
                <div class="content">
                  <div class="header">PatientName: {{image.patient.name}}</div>
                  <div class="ui horizontal divided list">
                    <div class="item">BirthDate: {{image.patient.birthdate}}</div>
                    <div class="item">Sex: {{image.patient.sex}}</div>
                  </div>
                </div>
              </div>
              
              <!--Annotations-->
              <div *ngFor="let anno of image.annotations" class="item">
                <i class="large blue tags link icon"></i>
                <div class="content">
                  <div class="header">Readability: {{anno.nodes.quality.fields.quality}}</div>
                  <div class="ui horizontal divided list">
                    <div class="item">Centered: {{anno.nodes.quality.fields.local || 'N/A'}}</div>
                    <div class="item">Retinopathy: {{anno.nodes.diagnosis ? anno.nodes.diagnosis.fields.retinopathy: 'N/A'}}</div>
                    <div class="item">Maculopathy: {{anno.nodes.diagnosis ? anno.nodes.diagnosis.fields.maculopathy: 'N/A'}}</div>
                    <div class="item">Photocoagulation: {{anno.nodes.diagnosis ? anno.nodes.diagnosis.fields.photocoagulation: 'N/A'}}</div>
                    <div class="item">Comorbidities: [{{anno.nodes.diagnosis ? anno.nodes.diagnosis.fields.diseases : 'N/A'}}]</div>
                    <div class="item">Lesions: [{{anno.nodes.lesions ? lesions(anno.nodes.lesions) : 'N/A'}}]</div>
                  </div>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </template>
    </tbody>
  </table>
</div>

<div style="margin: 0px 20px 0px 20px;">
  <div class="ui input" style="width: 4em">
    <input type="number" min="10" max="100" style="text-align: right;" [value]="pageSize" (input)="changePageSize($event.target.value)">
  </div>
  <div class="ui pagination menu">
    <a *ngFor="let p of pages" class="item {{p == selectedPage ? 'active' : ''}}" (click)="selectedPage = p">{{p}}</a>
  </div>
</div>

<div #modal_create_ds class="ui modal">
  <i class="close icon"></i>
  <div class="header">
    Create Dataset
  </div>
  <div class="content">
    <div class="description">
      <div class="ui header">Choose a dataset name:</div>
    </div>
    <div class="ui fluid input">
      <input #ds_name type="text" placeholder="Dataset Name...">
    </div>
    <div *ngIf="dsMessageError" class="ui negative message">
      <p>Please provide a dataset name!</p>
    </div>
  </div>
  <div class="actions">
    <div class="ui green button" (click)="createDataset(ds_name.value)">
      Create
    </div>
  </div>
</div>